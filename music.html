<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Music - Carlos Rodgarman</title>
    <meta name="description" content="Explore Carlos Rodgarman's music production work, including albums as producer, arranger, and engineer.">

    <!-- Preconnect para fuentes -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">

    <!-- CSS Global -->
    <link rel="stylesheet" href="css/variables.css">
    <link rel="stylesheet" href="css/reset.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="css/layout.css">

    <!-- CSS del CD Player -->
    <link rel="stylesheet" href="cd-player/cd-player.css">

    <!-- CSS específico de Music -->
    <link rel="stylesheet" href="css/pages/music.css">

    <!-- CSS Responsive -->
    <link rel="stylesheet" href="css/responsive.css">

    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="assets/logos/favicon.ico">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header__container">
            <a href="index.html" class="logo" aria-label="Volver al inicio">
                <img src="assets/logos/logo.svg" alt="Rodgarman">
            </a>

            <button class="nav__toggle" aria-label="Toggle navigation" aria-expanded="false">
                <span></span>
                <span></span>
                <span></span>
            </button>

            <nav class="nav">
                <ul class="nav__list">
                    <li class="nav__item">
                        <a href="index.html" class="nav__link">HOME</a>
                    </li>
                    <li class="nav__item">
                        <a href="rg-studio.html" class="nav__link">RG<br>STUDIO</a>
                    </li>
                    <li class="nav__item">
                        <a href="music.html" class="nav__link nav__link--active">MUSIC</a>
                    </li>
                    <li class="nav__item">
                        <a href="films.html" class="nav__link">FILMS<br>TV</a>
                    </li>
                    <li class="nav__item">
                        <a href="advertising.html" class="nav__link">ADVERTISING</a>
                    </li>
                    <li class="nav__item">
                        <a href="#technical" class="nav__link">TECHNICAL<br>videos</a>
                    </li>
                    <li class="nav__item">
                        <a href="#blog" class="nav__link">BLOG</a>
                    </li>
                    <li class="nav__item">
                        <a href="#about" class="nav__link">ABOUT</a>
                    </li>
                </ul>
            </nav>
        </div>
    </header>

    <!-- Music Hero Section (Telón) -->
    <section class="music-hero">
        <h1 class="music-hero__title">MUSIC</h1>
        <p class="music-hero__subtitle">Producer · Arranger · Engineer</p>
        <div class="music-hero__loader">
            <p class="music-hero__loader-text">LOADING</p>
            <div class="music-hero__loader-bar">
                <div class="music-hero__loader-progress"></div>
            </div>
        </div>
    </section>

    <main class="main">
        <!-- Albums Grid Section -->
        <section class="section section--dark music-grid-section">
            <div class="container container--wide">
                <div id="albumsGrid" class="albums-grid">
                    <!-- Los reproductores se cargarán aquí dinámicamente -->
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <p class="footer__text">© 2026 Carlos Rodgarman. All rights reserved.</p>
        </div>
    </footer>

    <!-- Scripts -->
    <script src="js/main.js"></script>
    <script src="cd-player/cd-player.js"></script>
    <script>
        // Initialize CD players with progressive loading
        const heroSection = document.querySelector('.music-hero');
        const gridContainer = document.getElementById('albumsGrid');
        const loaderProgress = document.querySelector('.music-hero__loader-progress');
        const BATCH_SIZE = 12; // Load 12 players at a time (3 rows of 4)

        // Check if curtain was already shown
        const curtainShown = sessionStorage.getItem('music-curtain-shown');

        if (curtainShown) {
            // Skip curtain animation, show content immediately
            heroSection.style.display = 'none';
        }

        // Simulate loading progress
        let currentProgress = 0;
        let progressInterval = null;

        function animateProgress() {
            if (!curtainShown && loaderProgress) {
                progressInterval = setInterval(() => {
                    if (currentProgress < 90) {
                        // Speed up progress as it goes
                        const increment = currentProgress < 30 ? 2 : currentProgress < 60 ? 3 : 5;
                        currentProgress += increment;
                        loaderProgress.style.width = currentProgress + '%';
                    }
                }, 50);
            }
        }

        function completeProgress() {
            if (progressInterval) {
                clearInterval(progressInterval);
            }
            if (loaderProgress) {
                currentProgress = 100;
                loaderProgress.style.width = '100%';
            }
        }

        // Start progress animation
        animateProgress();

        // Load players progressively
        fetch('cd-player/music-data.json')
            .then(response => response.json())
            .then(albums => {
                let loadedCount = 0;

                // Function to load a batch of players
                function loadBatch(startIndex) {
                    const endIndex = Math.min(startIndex + BATCH_SIZE, albums.length);
                    const batch = albums.slice(startIndex, endIndex);

                    batch.forEach((album, batchIndex) => {
                        const playerElement = document.createElement('div');
                        playerElement.className = 'cd-player';
                        playerElement.dataset.albumId = album.id;
                        gridContainer.appendChild(playerElement);

                        // Create player instance
                        new CDPlayer(playerElement, album);

                        // Reveal animation
                        const globalIndex = startIndex + batchIndex;
                        setTimeout(() => {
                            playerElement.classList.add('reveal');
                        }, 700 + (globalIndex * 20));
                    });

                    loadedCount += batch.length;

                    // Load next batch if there are more albums
                    if (loadedCount < albums.length) {
                        setTimeout(() => {
                            loadBatch(loadedCount);
                        }, 300);
                    }
                }

                if (!curtainShown) {
                    // Wait for window load, then complete progress and open curtain
                    window.addEventListener('load', () => {
                        completeProgress();
                        setTimeout(() => {
                            heroSection.classList.add('curtain-open');
                            sessionStorage.setItem('music-curtain-shown', 'true');
                            setTimeout(() => loadBatch(0), 700);
                        }, 300);
                    });

                    // Fallback: If load event doesn't fire in 3 seconds, open anyway
                    setTimeout(() => {
                        if (!heroSection.classList.contains('curtain-open')) {
                            completeProgress();
                            setTimeout(() => {
                                heroSection.classList.add('curtain-open');
                                sessionStorage.setItem('music-curtain-shown', 'true');
                                setTimeout(() => loadBatch(0), 700);
                            }, 300);
                        }
                    }, 3000);
                } else {
                    loadBatch(0);
                }
            })
            .catch(error => {
                console.error('Error loading CD player data:', error);
                heroSection.style.display = 'none';
            });
    </script>
</body>
</html>
